// tslint:disable-next-line:max-line-length
export const worker = `!function(e){var t={};function o(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=7)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeTempoBuckets=void 0;var r=o(5),s=o(4),n=o(3),a=o(2);t.computeTempoBuckets=((e,t)=>{const o=(0,s.getMaximumValue)(e),u=.3*o;let c=[],l=o-.05*o;if(o>.25)for(;c.length<30&&l>=u;)c=(0,n.getPeaksAtThreshold)(e,l,t),l-=.05*o;const p=(0,r.countIntervalsBetweenNearbyPeaks)(c),i=(0,a.groupNeighborsByTempo)(p,t);return i.sort((e,t)=>t.score-e.score),i})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.guess=void 0;var r=o(0);t.guess=((e,t)=>{const o=(0,r.computeTempoBuckets)(e,t);if(0===o.length)throw new Error("The given channelData does not contain any detectable beats.");var s=o[0];const n=s.peaks,a=s.tempo,u=Math.round(a),c=60/u;n.sort((e,t)=>e-t);let l=n[0]/t;for(;l>c;)l-=c;return{bpm:u,offset:l}})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.groupNeighborsByTempo=((e,t)=>{const o=[];return e.forEach(e=>{let r=60/(e.interval/t);for(;r<90;)r*=2;for(;r>180;)r/=2;let s=!1,n=e.peaks.length;o.forEach(t=>{if(t.tempo===r&&(t.score+=e.peaks.length,t.peaks=[...t.peaks,...e.peaks],s=!0),t.tempo>r-.5&&t.tempo<r+.5){const o=2*Math.abs(t.tempo-r);n+=(1-o)*t.peaks.length,t.score+=(1-o)*e.peaks.length}}),s||o.push({peaks:e.peaks,score:n,tempo:r})}),o})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getPeaksAtThreshold=((e,t,o)=>{const r=e.length,s=[];let n=!1;for(let a=0;a<r;a+=1)e[a]>t?n=!0:n&&(n=!1,s.push(a-1),a+=o/4-1);return n&&s.push(r-1),s})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getMaximumValue=(e=>{let t=0;const o=e.length;for(let r=0;r<o;r+=1)e[r]>t&&(t=e[r]);return t})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.countIntervalsBetweenNearbyPeaks=(e=>{const t=[];return e.forEach((o,r)=>{const s=Math.min(e.length-r,10);for(let n=1;n<s;n+=1){const s=e[r+n]-o;t.some(e=>e.interval===s&&(e.peaks.push(o),!0))||t.push({interval:s,peaks:[o]})}}),t})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.analyze=void 0;var r=o(0);t.analyze=((e,t)=>{const o=(0,r.computeTempoBuckets)(e,t);if(0===o.length)throw new Error("The given channelData does not contain any detectable beats.");return o[0].tempo})},function(e,t,o){"use strict";var r=o(6),s=o(1);addEventListener("message",({data:e})=>{try{if("analyze"===e.method){const o=e.id;var t=e.params;const s=t.channelData,n=t.sampleRate,a=(0,r.analyze)(s,n);postMessage({error:null,id:o,result:{tempo:a}})}else{if("guess"!==e.method)throw new Error('The given method "'+e.method+'" is not supported');{const t=e.id;var o=e.params;const r=o.channelData,a=o.sampleRate;var n=(0,s.guess)(r,a);const u=n.bpm,c=n.offset;postMessage({error:null,id:t,result:{bpm:u,offset:c}})}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`;
